# -*- coding: utf-8 -*-

# Diccionario que representa todo el árbol conversacional
chat_tree = {
    "Inicio": {
        "mensaje": "¡Hola! Bienvenido al soporte. ¿Cómo podemos ayudarte hoy?",
        "opciones": {
            "Problemas con el sistema": "Problemas_sistema",
            "Consultas sobre servicios": "Consultas_servicios",
            "Promociones": "Promociones",
            "Hablar con un agente humano": "Hablar_agente"
        }
    },

    # -------------------- PROBLEMAS CON EL SISTEMA --------------------
    "Problemas_sistema": {
        "mensaje": "Vamos a intentar solucionar el problema con el sistema. ¿Se carga la página correctamente?",
        "opciones": {
            "Sí": "Problemas_sistema_si",
            "No": "Verificar_conexion"
        }
    },

    "Problemas_sistema_si": {
        "mensaje": "Me indicas en qué más te puedo ayudar",
        "opciones": {}
    },

    "Verificar_conexion": {
        "mensaje": "Por favor, verifica que estés conectado a internet. ¿Funcionó?",
        "opciones": {
            "Sí": "Problemas_sistema_si",
            "No": "Probar_otro_navegador"
        }
    },

    "Probar_otro_navegador": {
        "mensaje": "Intenta abrir el sistema en otro navegador. ¿Funcionó?",
        "opciones": {
            "Sí": "Problemas_sistema_si",
            "No": "Derivar_operador"
        }
    },

    "Derivar_operador": {
        "mensaje": "Te voy a derivar a un operador. Por favor, espera un momento.",
        "opciones": {}
    },

    # -------------------- CONSULTAS SOBRE SERVICIOS --------------------
    "Consultas_servicios": {
        "mensaje": "¿Qué consulta deseas realizar?",
        "opciones": {
            "Realizar búsqueda de un servicio en el sistema": "Busqueda_servicio",
            "Procesar pago": "Procesar_pago",
            "Servicios disponibles por rubro": "Servicios_rubro"
        }
    },

    "Busqueda_servicio": {
        "mensaje": "Verifica el buscador e ingresa el nombre del servicio que deseas abonar. ¿Lograste encontrar el servicio?",
        "opciones": {
            "Sí": "Consulta_servicio_si",
            "No": "Derivar_operador"
        }
    },

    "Consulta_servicio_si": {
        "mensaje": "Me indicas en qué más te puedo ayudar",
        "opciones": {}
    },

    "Procesar_pago": {
        "mensaje": "Al momento de completar los campos, presioná el botón de procesar pago. ¿Lograste realizar el pago?",
        "opciones": {
            "Sí": "Consulta_servicio_si",
            "No": "Derivar_operador"
        }
    },

    "Servicios_rubro": {
        "mensaje": "Estos son los servicios disponibles para tu local comercial. ¿Lograste verificar el servicio que deseas abonar?",
        "opciones": {
            "Sí": "Consulta_servicio_si",
            "No": "Derivar_operador"
        }
    },

    # -------------------- PROMOCIONES --------------------
    "Promociones": {
        "mensaje": "Selecciona el tipo de promoción que deseas consultar:",
        "opciones": {
            "Promociones vigentes": "Promociones_vigentes",
            "Cómo participar en promociones": "Participar_promociones"
        }
    },

    "Promociones_vigentes": {
        "mensaje": "Actualmente tenemos las siguientes promociones activas. ¿Tenés alguna duda o consulta más referente a las promociones?",
        "opciones": {
            "Sí": "Consulta_servicio_si",
            "No": "Encuesta_final"
        }
    },

    "Participar_promociones": {
        "mensaje": "Para participar, sigue estos pasos. ¿Tenés alguna duda o consulta más referente a las promociones?",
        "opciones": {
            "Sí": "Consulta_servicio_si",
            "No": "Encuesta_final"
        }
    },

    # -------------------- AGENTE HUMANO --------------------
    "Hablar_agente": {
        "mensaje": "Te voy a derivar a un operador. Por favor, espera un momento.",
        "opciones": {}
    },

    # -------------------- ENCUESTA FINAL --------------------
    "Encuesta_final": {
        "mensaje": "Por favor, califica tu experiencia del 1 al 5, donde 1 es muy insatisfecho y 5 muy satisfecho.",
        "opciones": {
            "1": None,
            "2": None,
            "3": None,
            "4": None,
            "5": None
        }
    }
}

# ----------------------------------------------------------------------
# FUNCIÓN PRINCIPAL
# ----------------------------------------------------------------------

def iniciar_chat(nodo_actual="Inicio"):
    nodo = chat_tree[nodo_actual]
    print("\nBot:", nodo["mensaje"])

    # Si hay opciones, mostrarlas
    if nodo["opciones"]:
        print("\nOpciones:")
        for i, opcion in enumerate(nodo["opciones"], 1):
            print(f"{i}. {opcion}")

        eleccion = input("\nTu respuesta: ").strip()
        opciones_lista = list(nodo["opciones"].keys())
        siguiente_nodo = None

        # Si ingresan un número
        if eleccion.isdigit() and 1 <= int(eleccion) <= len(opciones_lista):
            siguiente_nodo = nodo["opciones"][opciones_lista[int(eleccion)-1]]

        # Si ingresan el texto exacto
        elif eleccion in nodo["opciones"]:
            siguiente_nodo = nodo["opciones"][eleccion]

        else:
            print("Opción no válida, intenta de nuevo.")
            iniciar_chat(nodo_actual)
            return

        if siguiente_nodo:
            iniciar_chat(siguiente_nodo)
        else:
            print("\nFin de la interacción.")

    else:
        # Nodos que NO deben ofrecer volver al inicio
        if nodo_actual in ["Hablar_agente", "Derivar_operador"]:
            print("\nFin de la interacción.")
            return

        # Nodo sin opciones normal
        respuesta = input("\n¿Querés volver al inicio? (sí/no): ").strip().lower()
        if respuesta in ["sí", "si"]:
            iniciar_chat("Inicio")
        else:
            print("\nFin de la interacción.")


# Ejecutar el asistente
if __name__ == "__main__":
    iniciar_chat()

